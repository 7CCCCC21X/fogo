<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>排行榜</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1, h2 {
      color: #333;
    }
    .tab-nav {
      margin-bottom: 20px;
    }
    .tab-nav button {
      padding: 10px 20px;
      margin-right: 10px;
      border: none;
      background-color: #f5f5f5;
      cursor: pointer;
      border-radius: 4px;
    }
    .tab-nav button.active {
      background-color: #0066cc;
      color: white;
    }
    .search-box {
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f5f5f5;
    }
    .no-data td {
      color: #999;
      font-style: italic;
    }
    /* 默认隐藏所有排行榜 */
    .leaderboard-section {
      display: none;
    }
  </style>
</head>
<body>
  <h1>排行榜汇总</h1>

  <!-- 选项卡导航 -->
  <div class="tab-nav">
    <button data-target="tradingSection" class="tab-btn active">TRADING</button>
    <button data-target="stakingSection" class="tab-btn">STAKING</button>
    <button data-target="discordSection" class="tab-btn">DISCORD</button>
    <button data-target="xcomSection" class="tab-btn">X.COM</button>
  </div>

  <!-- 批量查询/过滤输入框（只针对当前显示的排行榜） -->
  <div class="search-box">
    <input type="text" id="queryInput" placeholder="请输入地址或关键词查询..." style="width:300px; padding:8px;">
    <button onclick="filterCurrentTable()">查询</button>
  </div>

  <!-- TRADING排行榜 -->
  <section id="tradingSection" class="leaderboard-section">
    <h2>TRADING</h2>
    <table id="tradingTable">
      <thead>
        <tr>
          <th>排名</th>
          <th>地址</th>
          <th>分数</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- STAKING排行榜 -->
  <section id="stakingSection" class="leaderboard-section">
    <h2>STAKING</h2>
    <table id="stakingTable">
      <thead>
        <tr>
          <th>排名</th>
          <th>地址</th>
          <th>分数</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- DISCORD排行榜 -->
  <section id="discordSection" class="leaderboard-section">
    <h2>DISCORD</h2>
    <table id="discordTable">
      <thead>
        <tr>
          <th>排名</th>
          <th>地址</th>
          <th>分数</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- X.COM排行榜 -->
  <section id="xcomSection" class="leaderboard-section">
    <h2>X.COM</h2>
    <table id="xcomTable">
      <thead>
        <tr>
          <th>排名</th>
          <th>地址</th>
          <th>分数</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    // 正则匹配每一行格式：例如
    // "排名: 1, 地址: 0x9ed15383940cc380faef0a75edace507cc775f22, 分数: 42000"
    const lineRegex = /排名:\s*(\d+)\s*,\s*地址:\s*([^,]+)\s*,\s*分数:\s*(\d+)/;

    // 加载并解析单个排行榜文件
    async function loadLeaderboard(filePath, tableId) {
      try {
        const response = await fetch(filePath);
        if (!response.ok) {
          throw new Error('无法加载 ' + filePath);
        }
        const text = await response.text();
        const lines = text.trim().split('\n');
        const tbody = document.getElementById(tableId).querySelector('tbody');

        lines.forEach(line => {
          const match = line.match(lineRegex);
          if (match) {
            const rank = match[1];
            const address = match[2];
            const score = match[3];

            const tr = document.createElement('tr');

            let tdRank = document.createElement('td');
            tdRank.textContent = rank;
            tr.appendChild(tdRank);

            let tdAddress = document.createElement('td');
            tdAddress.textContent = address;
            tr.appendChild(tdAddress);

            let tdScore = document.createElement('td');
            tdScore.textContent = score;
            tr.appendChild(tdScore);

            tbody.appendChild(tr);
          }
        });
      } catch (error) {
        console.error('Error loading leaderboard:', error);
      }
    }

    // 分别加载四个排行榜数据
    loadLeaderboard('data/trading.txt', 'tradingTable');
    loadLeaderboard('data/staking.txt', 'stakingTable');
    loadLeaderboard('data/discord.txt', 'discordTable');
    loadLeaderboard('data/xcom.txt', 'xcomTable');

    // 选项卡切换功能
    const tabButtons = document.querySelectorAll('.tab-btn');
    tabButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        // 清除所有按钮 active 样式
        tabButtons.forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        // 隐藏所有排行榜 section
        const sections = document.querySelectorAll('.leaderboard-section');
        sections.forEach(section => section.style.display = 'none');

        // 显示点击对应的排行榜
        const targetId = this.getAttribute('data-target');
        document.getElementById(targetId).style.display = 'block';

        // 清空搜索输入并重置过滤状态
        document.getElementById('queryInput').value = '';
        resetTable(targetId);
      });
    });

    // 页面加载时默认显示第一个选项卡
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('tradingSection').style.display = 'block';
    });

    // 批量查询：仅对当前显示的排行榜进行搜索过滤
    function filterCurrentTable() {
      const query = document.getElementById('queryInput').value.trim().toLowerCase();
      // 获取当前显示的 section（排行榜）
      const currentSection = Array.from(document.querySelectorAll('.leaderboard-section'))
                            .find(section => section.style.display !== 'none');
      if (!currentSection) return;
      
      const tbody = currentSection.querySelector('table tbody');
      let matchedCount = 0;
      Array.from(tbody.rows).forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(query)) {
          row.style.display = '';
          matchedCount++;
        } else {
          row.style.display = 'none';
        }
      });

      // 如果没有匹配则显示“无”提示行
      let noDataRow = tbody.querySelector('.no-data');
      if (matchedCount === 0) {
        if (!noDataRow) {
          noDataRow = document.createElement('tr');
          noDataRow.className = 'no-data';
          const td = document.createElement('td');
          td.colSpan = tbody.parentNode.querySelector('thead tr').childElementCount;
          td.textContent = '无';
          noDataRow.appendChild(td);
          tbody.appendChild(noDataRow);
        }
      } else {
        if (noDataRow) {
          noDataRow.remove();
        }
      }
    }

    // 重置当前表格所有行的显示状态（用于切换选项卡时清除过滤效果）
    function resetTable(sectionId) {
      const tbody = document.getElementById(sectionId).querySelector('table tbody');
      Array.from(tbody.rows).forEach(row => {
        row.style.display = '';
      });
      // 如果有“无”提示行也移除
      const noDataRow = tbody.querySelector('.no-data');
      if (noDataRow) {
        noDataRow.remove();
      }
    }
  </script>
</body>
</html>
